# ~/.bashrc
# Generated by Chezmoi template

# If not running interactively, don't do anything
[[ $- != *i* ]] && return

# Basic configuration
HISTCONTROL=ignoreboth
HISTSIZE=1000
HISTFILESIZE=2000
shopt -s histappend
shopt -s checkwinsize

# Prompt customization
{{ if .dark_theme }}
PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
{{ else }}
PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
{{ end }}

# OS-specific configuration
{{ if eq .chezmoi.os "darwin" }}
# macOS specific
export PATH="$PATH:/usr/local/bin:/opt/homebrew/bin"
alias ls='ls -G'
alias ll='ls -lahG'
export CLICOLOR=1

# Homebrew
if [[ -f "/opt/homebrew/bin/brew" ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
fi

{{ else if eq .chezmoi.os "linux" }}
# Linux specific
export PATH="$PATH:/usr/local/bin"
alias ls='ls --color=auto'
alias ll='ls -lah --color=auto'
alias grep='grep --color=auto'

# Distribution specific
{{ if eq .chezmoi.osRelease.id "ubuntu" }}
# Ubuntu specific
alias apt-up='sudo apt update && sudo apt upgrade'
{{ else if eq .chezmoi.osRelease.id "fedora" }}
# Fedora specific
alias dnf-up='sudo dnf upgrade --refresh'
{{ end }}

{{ end }}

# Editor configuration
export EDITOR="{{ .editor | default "vim" }}"
export VISUAL="$EDITOR"

# Development environment
{{ if .development.go }}
export GOPATH="$HOME/go"
export PATH="$PATH:$GOPATH/bin"
{{ end }}

{{ if .development.node }}
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
{{ end }}

{{ if .development.python }}
export PATH="$PATH:$HOME/.local/bin"
export PYENV_ROOT="$HOME/.pyenv"
[[ -d "$PYENV_ROOT/bin" ]] && export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init - bash 2>/dev/null || true)"
{{ end }}

# Work-specific configuration
{{ if eq .chezmoi.hostname "work-laptop" }}
# Work environment
export WORK_ENV="production"
export COMPANY_EMAIL="{{ .work_email }}"

# Work aliases
alias work-ssh='ssh work-server'
alias work-vpn='sudo openvpn --config /etc/openvpn/work.conf'

{{ else }}
# Personal environment
export WORK_ENV="personal"

# Personal aliases
{{ if .aliases }}
{{ range .aliases }}
alias {{ .name }}='{{ .command }}'
{{ end }}
{{ end }}

{{ end }}

# General aliases
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias mkdir='mkdir -pv'
alias wget='wget -c'
alias histg='history | grep'

# Function for directory navigation
up() {
    local d=""
    limit=$1
    for ((i=1 ; i <= limit ; i++)); do
        d="../$d"
    done
    cd "$d"
}

# Function to create and enter directory
mkcd() {
    mkdir -p "$1" && cd "$1"
}

# Function to extract archives
extract() {
    if [[ -f "$1" ]]; then
        case "$1" in
            *.tar.bz2)   tar xjf "$1"     ;;
            *.tar.gz)    tar xzf "$1"     ;;
            *.bz2)       bunzip2 "$1"     ;;
            *.rar)       unrar x "$1"     ;;
            *.gz)        gunzip "$1"      ;;
            *.tar)       tar xf "$1"      ;;
            *.tbz2)      tar xjf "$1"     ;;
            *.tgz)       tar xzf "$1"     ;;
            *.zip)       unzip "$1"       ;;
            *.Z)         uncompress "$1"  ;;
            *.7z)        7z x "$1"        ;;
            *)           echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# Load local customizations if they exist
if [[ -f "$HOME/.bashrc.local" ]]; then
    source "$HOME/.bashrc.local"
fi

# Load machine-specific customizations
if [[ -f "$HOME/.bashrc.{{ .chezmoi.hostname }}" ]]; then
    source "$HOME/.bashrc.{{ .chezmoi.hostname }}"
fi